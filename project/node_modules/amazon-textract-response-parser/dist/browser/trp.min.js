var trp=function(e){"use strict";var t,n;e.ApiRelationshipType=void 0,(t=e.ApiRelationshipType||(e.ApiRelationshipType={})).Answer="ANSWER",t.Child="CHILD",t.ComplexFeatures="COMPLEX_FEATURES",t.MergedCell="MERGED_CELL",t.TableFooter="TABLE_FOOTER",t.TableTitle="TABLE_TITLE",t.Value="VALUE",e.ApiBlockType=void 0,(n=e.ApiBlockType||(e.ApiBlockType={})).Cell="CELL",n.Key="KEY",n.KeyValueSet="KEY_VALUE_SET",n.LayoutFigure="LAYOUT_FIGURE",n.LayoutFooter="LAYOUT_FOOTER",n.LayoutHeader="LAYOUT_HEADER",n.LayoutKeyValue="LAYOUT_KEY_VALUE",n.LayoutList="LAYOUT_LIST",n.LayoutPageNumber="LAYOUT_PAGE_NUMBER",n.LayoutSectionHeader="LAYOUT_SECTION_HEADER",n.LayoutTable="LAYOUT_TABLE",n.LayoutText="LAYOUT_TEXT",n.LayoutTitle="LAYOUT_TITLE",n.Line="LINE",n.MergedCell="MERGED_CELL",n.Page="PAGE",n.Query="QUERY",n.QueryResult="QUERY_RESULT",n.SelectionElement="SELECTION_ELEMENT",n.Signature="SIGNATURE",n.Table="TABLE",n.TableFooter="TABLE_FOOTER",n.TableTitle="TABLE_TITLE",n.Value="VALUE",n.Word="WORD";const i=new Set(["LAYOUT_FIGURE","LAYOUT_FOOTER","LAYOUT_HEADER","LAYOUT_KEY_VALUE","LAYOUT_LIST","LAYOUT_PAGE_NUMBER","LAYOUT_SECTION_HEADER","LAYOUT_TABLE","LAYOUT_TEXT","LAYOUT_TITLE"]);function isLayoutBlockType(e){return i.has(e)}var s,r,o,l,a,c,u,h,d,p,g;e.ApiTextType=void 0,(s=e.ApiTextType||(e.ApiTextType={})).Handwriting="HANDWRITING",s.Printed="PRINTED",e.ApiSelectionStatus=void 0,(r=e.ApiSelectionStatus||(e.ApiSelectionStatus={})).Selected="SELECTED",r.NotSelected="NOT_SELECTED",e.ApiKeyValueEntityType=void 0,(o=e.ApiKeyValueEntityType||(e.ApiKeyValueEntityType={})).Key="KEY",o.Value="VALUE",e.ApiJobStatus=void 0,(l=e.ApiJobStatus||(e.ApiJobStatus={})).Failed="FAILED",l.InProgress="IN_PROGRESS",l.PartialSuccess="PARTIAL_SUCCESS",l.Succeeded="SUCCEEDED",e.ApiTableEntityType=void 0,(a=e.ApiTableEntityType||(e.ApiTableEntityType={})).StructuredTable="STRUCTURED_TABLE",a.SemiStructuredTable="SEMI_STRUCTURED_TABLE",e.ApiTableCellEntityType=void 0,(c=e.ApiTableCellEntityType||(e.ApiTableCellEntityType={})).Title="TABLE_TITLE",c.Footer="TABLE_FOOTER",c.SectionTitle="TABLE_SECTION_TITLE",c.ColumnHeader="COLUMN_HEADER",c.Summary="TABLE_SUMMARY";class ApiObjectWrapper{constructor(e){this._dict=e}get dict(){return this._dict}}class ApiBlockWrapper extends ApiObjectWrapper{get id(){return this._dict.Id}get blockType(){return this._dict.BlockType}get childBlockIds(){return this.relatedBlockIdsByRelType("CHILD")}relatedBlockIdsByRelType(e){const t=Array.isArray(e);let n=[];return(this._dict.Relationships||[]).forEach((i=>{t?e.indexOf(i.Type)>=0&&(n=n.concat(i.Ids)):i.Type===e&&(n=n.concat(i.Ids))})),n}}class DocumentMetadata extends ApiObjectWrapper{get nPages(){var e;return(null===(e=this._dict)||void 0===e?void 0:e.Pages)||0}}function getIterable(e){return{[Symbol.iterator]:()=>{const t=e();let n=0;return{next:()=>n<t.length?{done:!1,value:t[n++]}:{done:!0,value:void 0}}}}}function escapeHtml(e,{forAttr:t=!1}={}){return e.replace(t?/[&<>'"]/g:/[&<>]/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[e])))}function indent(e,{character:t="\t",count:n=1,includeEmptyLines:i=!1,skipFirstLine:s=!1}={}){const r=e.replace(i?/^/gm:/^(?!\s*$)/gm,t.repeat(n));return s?r.substring(n*t.length):r}function modalAvg(e){const t={};for(const n of e)t[n]?++t[n].freq:t[n]={value:n,freq:1};let n=0,i=null;for(const e in t)t[e].freq>n&&(n=t[e].freq,i=t[e].value);return i}function aggregate(e,t){const n=Array.isArray(e)?e:Array.from(e);if(0===n.length)return null;if("GEOMEAN"===t)return Math.exp(n.reduce(((e,t)=>e+Math.log(t)),0)/n.length);if("MAX"===t)return Math.max(...n);if("MEAN"===t)return n.reduce(((e,t)=>e+t),0)/n.length;if("MIN"===t)return Math.min(...n);if("MODE"===t)return modalAvg(n);throw new Error(`Unsupported aggMethod '${t}' not in allowed AggregationMethod enum`)}function argMax(e){return e.reduce(((e,t,n)=>t>e.maxValue?{maxValue:t,maxIndex:n}:e),{maxValue:-1/0,maxIndex:-1})}e.AggregationMethod=void 0,(u=e.AggregationMethod||(e.AggregationMethod={})).GeometricMean="GEOMEAN",u.Max="MAX",u.Mean="MEAN",u.Min="MIN",u.Mode="MODE";class PageHostedApiBlockWrapper extends ApiBlockWrapper{constructor(e,t){super(e),this._parentPage=t,t.registerParsedItem(e.Id,this)}get parentPage(){return this._parentPage}}class BoundingBox extends ApiObjectWrapper{constructor(e,t=null){super(e),this._parentGeometry=t}get bottom(){return this.top+this.height}get hCenter(){return this.left+this.width/2}get height(){return this._dict.Height}get left(){return this._dict.Left}get parentGeometry(){return this._parentGeometry}get top(){return this._dict.Top}get right(){return this.left+this.width}get vCenter(){return this.top+this.height/2}get width(){return this._dict.Width}union(e){const t=Math.min(this.left,e.left),n=Math.min(this.top,e.top),i=Math.max(this.right,e.right),s=Math.max(this.bottom,e.bottom);return new BoundingBox({Height:s-n,Left:t,Top:n,Width:i-t},null)}intersection(e){const t=Math.max(this.top,e.top),n=Math.min(this.bottom,e.bottom),i=Math.max(0,n-t),s=Math.max(this.left,e.left),r=Math.min(this.right,e.right),o=Math.max(0,r-s);return i>0&&o>0?new BoundingBox({Height:n-t,Left:s,Top:t,Width:r-s},null):null}str(){return`width: ${this._dict.Width}, height: ${this._dict.Height}, left: ${this._dict.Left}, top: ${this._dict.Top}`}}class Point extends ApiObjectWrapper{constructor(e,t=null){super(e),this._parentGeometry=t}get parentGeometry(){return this._parentGeometry}get x(){return this._dict.X}get y(){return this._dict.Y}str(){return`x: ${this._dict.X}, y: ${this._dict.Y}`}}class Geometry extends ApiObjectWrapper{constructor(e,t){super(e),this._parentObject=t,this._boundingBox=new BoundingBox(e.BoundingBox,this),this._polygon=e.Polygon.map((e=>new Point(e,this)))}get boundingBox(){return this._boundingBox}get parentObject(){return this._parentObject}get polygon(){return this._polygon.slice()}orientationRadians(){if(this._polygon.length<2)return null;const e=this._polygon[0],t=this._polygon[1];return Math.atan2(t.y-e.y,t.x-e.x)}orientationDegrees(){const e=this.orientationRadians();return null==e?e:180*e/Math.PI}str(){return`BoundingBox: ${this._boundingBox.str()}`}}class Word extends ApiBlockWrapper{constructor(e){super(e),this._geometry=new Geometry(e.Geometry,this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get text(){return this._dict.Text}get textType(){return this._dict.TextType}set textType(e){this._dict.TextType=e}html(){return escapeHtml(this.text)}str(){return this.text}}function buildWithContent({contentTypes:e=["SELECTION_ELEMENT","SIGNATURE","WORD"],strict:t=!1}={}){return function WithContent(n){return class extends n{iterContent(){return{[Symbol.iterator]:()=>{const n=this.childBlockIds;let i=0;return{next:()=>{let s;for(;i<n.length;){const r=this.parentPage.getItemByBlockId(n[i]);if(++i,!e.length||e.indexOf(r.blockType)>=0){s=r;break}if(t)throw new Error(`Child ${r.id} of parent ${this.id} has unexpected non-content block type ${r.blockType}`)}return s?{done:!1,value:s}:{done:!0,value:void 0}}}}}}listContent(){if(!this.dict.Relationships)return[];const n=[];for(const i of this.childBlockIds){const s=this.parentPage.getItemByBlockId(i);if(!e.length||e.indexOf(s.blockType)>=0)n.push(s);else if(t)throw new Error(`Child ${s.id} of parent ${this.id} has unexpected non-content block type ${s.blockType}`)}return n}get nContentItems(){return this.listContent().length}get text(){return this.listContent().map((e=>e.text)).join(" ")}}}}function WithWords(e){return class extends e{iterWords(){return{[Symbol.iterator]:()=>{const e=this.childBlockIds;let t=0;return{next:()=>{let n;for(;t<e.length;){const i=this.parentPage.getItemByBlockId(e[t]);if(++t,"WORD"===i.blockType){n=i;break}}return n?{done:!1,value:n}:{done:!0,value:void 0}}}}}}listWords(){if(!this.dict.Relationships)return console.warn(`Tried to fetch WORD children on block ${this.id} of type ${this.blockType} with no 'Relationships'`),[];const e=[];for(const t of this.childBlockIds){const n=this.parentPage.getItemByBlockId(t);"WORD"===n.blockType&&e.push(n)}return e}get nWords(){return this.listWords().length}get text(){return this.listWords().map((e=>e.text)).join(" ")}wordAtIndex(e){if(e<0)throw new Error(`Word index ${e} must be >=0`);let t=0;for(const n of this.iterWords()){if(t===e)return n;++t}throw new Error(`Word index ${e} out of bounds for length ${t}`)}}}class LineGeneric extends(WithWords(PageHostedApiBlockWrapper)){constructor(e,t){super(e,t),this._geometry=new Geometry(e.Geometry,this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get text(){return this._dict.Text}html(){return escapeHtml(this.text)}str(){return`Line\n==========\n${this._dict.Text}\nWords\n----------\n${this.listWords().map((e=>`[${e.str()}]`)).join("")}`}}class SelectionElement extends ApiBlockWrapper{constructor(e){super(e),this._geometry=new Geometry(e.Geometry,this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get selectionStatus(){return this._dict.SelectionStatus}set selectionStatus(e){this._dict.SelectionStatus=e}html(){return`<input type="checkbox" disabled ${"SELECTED"===this.selectionStatus?"checked ":""}/>`}str(){return this.selectionStatus}get text(){return this.selectionStatus}}class Signature extends ApiBlockWrapper{constructor(e){super(e),this._geometry=new Geometry(e.Geometry,this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}html(){return'<input class="signature" type="text" disabled value="[SIGNATURE]"/>'}str(){return"/-------------\\\n| [SIGNATURE] |\n\\-------------/"}get text(){return""}}class FieldKeyGeneric extends(WithWords(PageHostedApiBlockWrapper)){constructor(e,t){super(e,t.parentPage),this._parentField=t,this._geometry=new Geometry(e.Geometry,this)}get geometry(){return this._geometry}get parentField(){return this._parentField}get confidence(){return this._dict.Confidence}getOcrConfidence(e="MEAN"){return aggregate(this.listWords().map((e=>e.confidence)),e)}html(){return escapeHtml(this.text)}str(){return this.text}}class FieldValueGeneric extends(buildWithContent()(PageHostedApiBlockWrapper)){constructor(e,t){super(e,t.parentPage),this._parentField=t,this._geometry=new Geometry(e.Geometry,this)}get confidence(){return this._dict.Confidence}get geometry(){return this._geometry}get parentField(){return this._parentField}getOcrConfidence(e="MEAN"){return aggregate(this.listContent().map((e=>e.confidence)),e)}html(){return escapeHtml(this.text)}str(){return this.text}}class FieldGeneric{constructor(e,t){this._parentForm=t,this._value=null,this._key=new FieldKeyGeneric(e,this);let n=[];if((e.Relationships||[]).forEach((e=>{"VALUE"==e.Type&&(n=n.concat(e.Ids))})),n.length>1){const e=this._key?`field '${this._key.text}'`:"unnamed form field";console.warn(`Got ${n.length} value blocks for ${e} (Expected 0-1). Including first only.`)}if(n.length){const e=n[0],i=t.parentPage.getBlockById(e);i?this._value=new FieldValueGeneric(i,this):console.warn(`Document missing child block ${e} referenced by value for field key ${this.key.id}`)}}get blockType(){return this._key.blockType}get confidence(){const e=[];return this._key&&e.push(this._key.confidence||0),this._value&&e.push(this._value.confidence||0),e.length?e.reduce(((e,t)=>e+t),0)/e.length:0}get childBlockIds(){return this._key.childBlockIds}get dict(){return this._key.dict}get id(){return this._key.id}get key(){return this._key}get parentForm(){return this._parentForm}get parentPage(){return this._parentForm.parentPage}get text(){var e;return`${this._key.text}: ${(null===(e=this._value)||void 0===e?void 0:e.text)||""}`}get value(){return this._value}getOcrConfidence(e="MEAN"){return aggregate((this._value?this._value.listContent():[]).concat(this._key.listWords()).map((e=>e.confidence)),e)}relatedBlockIdsByRelType(e){return this._key.relatedBlockIdsByRelType(e)}html(){var e;return`<input label="${escapeHtml(this._key.text,{forAttr:!0})}" type="text" disabled value="${escapeHtml((null===(e=this._value)||void 0===e?void 0:e.text)||"",{forAttr:!0})}" />`}str(){return`\nField\n==========\nKey: ${this._key?this._key.str():""}\nValue: ${this._value?this._value.str():""}`}}class FormGeneric{constructor(e,t){this._fields=[],this._fieldsMap={},this._parentPage=t,e.forEach((e=>{const t=new FieldGeneric(e,this);this._fields.push(t);const n=t.key.text||"";n&&(n in this._fieldsMap?t.confidence>this._fieldsMap[n].confidence&&(this._fieldsMap[n]=t):this._fieldsMap[n]=t)}))}get nFields(){return this._fields.length}get parentPage(){return this._parentPage}get text(){return this.listFields().map((e=>e.text)).join("\n")}getFieldByKey(e){return this._fieldsMap[e]||null}html(){return`<form>\n${indent(this.listFields().map((e=>e.html())).join("\n"))}\n</form>`}iterFields(e=!1){return getIterable((()=>this.listFields(e)))}listFields(e=!1){return e?this._fields.filter((e=>e.key)):this._fields.slice()}searchFieldsByKey(e){const t=e.toLowerCase();return this._fields.filter((e=>e.key&&e.key.text.toLowerCase().indexOf(t)>=0))}str(){return this._fields.map((e=>e.str())).join("\n")}}class FormsCompositeGeneric{constructor(e,t){this._forms=e,this._parentDocument=t}get nFields(){return this._forms.reduce(((e,t)=>e+t.nFields),0)}get parentDocument(){return this._parentDocument}get text(){return this._forms.map((e=>e.text)).join("\n\n")}getFieldByKey(e){for(const t of this._forms){const n=t.getFieldByKey(e);if(n)return n}return null}html(){const e=this._forms.map(((e,t)=>`<div class="form-page" id="form-page-${t}">\n${indent(e.listFields().map((e=>`${e.html()}\n`)).join(""))}</div>\n`));return`<form>\n${indent(e.join(""))}</form>`}iterFields(e=!1){return getIterable((()=>this.listFields(e)))}listFields(e=!1){const t=[].concat(...this._forms.map((e=>e.listFields())));return e?t.filter((e=>e.key)):t}searchFieldsByKey(e){return[].concat(...this._forms.map((t=>t.searchFieldsByKey(e))))}str(){return this._forms.map((e=>e.str())).join("\n")}}class LayoutItemBaseGeneric extends PageHostedApiBlockWrapper{constructor(e,t){super(e,t.parentPage),this._geometry=new Geometry(e.Geometry,this),this._parentLayout=t}get confidence(){return this._dict.Confidence}get geometry(){return this._geometry}get parentLayout(){return this._parentLayout}}class LayoutLineContainerItem extends(buildWithContent({contentTypes:["LINE"]})(LayoutItemBaseGeneric)){iterTextLines(){return getIterable((()=>this.listTextLines()))}listTextLines(){return this.listContent()}get nTextLines(){return this.listTextLines().length}get text(){return this.listContent().map((e=>e.text)).join("\n")}}class LayoutFigureGeneric extends LayoutLineContainerItem{html(){return`<div class="figure">${this.text?`\n${indent(escapeHtml(this.text))}\n`:""}</div>`}str(){return`#### Figure ####\n${this.text}${this.text?"\n":""}################`}}class LayoutFooterGeneric extends LayoutLineContainerItem{html(){return`<div class="footer-el">\n${indent(escapeHtml(this.text))}\n</div>`}str(){return`---- Footer text ----\n${this.text}\n---------------------`}}class LayoutHeaderGeneric extends LayoutLineContainerItem{html(){return`<div class="header-el">\n${indent(escapeHtml(this.text))}\n</div>`}str(){return`---- Header text ----\n${this.text}\n---------------------`}}class LayoutKeyValueGeneric extends LayoutLineContainerItem{_listContentIdsInFormField(e){const t=e.key.listWords().map((e=>e.id)),n=e.value;return n?t.concat(n.listContent().map((e=>e.id))):t}_mapPageContentToFormFields(){const e={};return this.parentPage.form.listFields().forEach((t=>{this._listContentIdsInFormField(t).forEach((n=>{e[n]=t}))})),e}iterFields(){return getIterable((()=>this.listFields()))}listFields(){const e=this._mapPageContentToFormFields(),t={},n=[];for(const i of this.iterContent())for(const s of i.iterWords()){if(s.id in t)continue;const i=e[s.id];i&&(n.push(i),this._listContentIdsInFormField(i).forEach((e=>{t[e]=!0})))}return n}html(){const e=this._mapPageContentToFormFields(),t={},n=[];for(const i of this.iterContent()){const s=[];for(const n of i.iterWords()){const i=n.id;if(!(i in t))if(i in e){const n=e[i];s.push(n.html()),this._listContentIdsInFormField(n).forEach((e=>{t[e]=!0}))}else s.push(n.html())}n.push(s.join(" "))}return`<div class="key-value">\n${indent(n.filter((e=>e)).join("\n"))}\n</div>`}str(){return`---- Key-value ----\n${this.text}\n-------------------`}}class LayoutPageNumberGeneric extends LayoutLineContainerItem{html(){return`<div class="page-num">\n${indent(escapeHtml(this.text))}\n</div>`}str(){return`---- Page number: ${this.text}`}}class LayoutSectionHeaderGeneric extends LayoutLineContainerItem{html(){return`<h2>\n${indent(escapeHtml(this.text))}\n</h2>`}str(){return`\n${this.text}\n${"-".repeat(this.text.length)}\n`}}class LayoutTableGeneric extends LayoutLineContainerItem{_listContentIdsInTable(e){const t=e.listRows().map((e=>e.listCells().map((e=>e.listContent().map((e=>e.id)).flat())).flat())).flat(),n=e.listFooters().map((e=>e.listWords().map((e=>e.id)).flat())).flat();return e.listTitles().map((e=>e.listWords().map((e=>e.id)).flat())).flat().concat(t,n)}_mapPageContentToTables(){const e={};return this.parentPage.listTables().forEach((t=>{this._listContentIdsInTable(t).forEach((n=>{e[n]=t}))})),e}iterTables(){return getIterable((()=>this.listTables()))}listTables(){const e=this._mapPageContentToTables(),t={},n=[];for(const i of this.iterContent())for(const s of i.iterWords()){if(s.id in t)continue;const i=e[s.id];i&&(n.push(i),this._listContentIdsInTable(i).forEach((e=>{t[e]=!0})))}return n}html(){const e=this._mapPageContentToTables(),t={},n=[];for(const i of this.iterContent()){const s=[];for(const n of i.iterWords()){const i=n.id;if(!(i in t))if(i in e){const n=e[i];s.push(n.html()),this._listContentIdsInTable(n).forEach((e=>{t[e]=!0}))}else s.push(n.html())}n.push(s.join(" "))}return`<div class="table">\n${indent(n.filter((e=>e)).join("\n"))}\n</div>`}str(){return["|==== Table (structure unknown) ====|",this.text,"|==================================|"].join("\n")}}class LayoutTextGeneric extends LayoutLineContainerItem{html(){return`<p>\n${indent(escapeHtml(this.text))}\n</p>`}str(){return this.text}}class LayoutTitleGeneric extends LayoutLineContainerItem{html(){return`<h1>\n${indent(escapeHtml(this.text))}\n</h1>`}str(){return`\n\n${this.text}\n${"=".repeat(this.text.length)}\n`}}class LayoutListGeneric extends(buildWithContent({contentTypes:["LAYOUT_TEXT"]})(LayoutItemBaseGeneric)){html(){return`<ul>\n${indent(this.listContent().map((e=>`<li>${e.html()}</li>`)).join("\n"))}\n</ul>`}iterTextLines(){return getIterable((()=>this.listTextLines()))}listTextLines(){return function extractLinesRecursive(e){return e.map((e=>"LINE"===e.blockType?[e]:void 0!==e.listContent?extractLinesRecursive(e.listContent()):[])).flat()}(this.listContent())}str(){return this.text}get nTextLines(){return this.listTextLines().length}get text(){return this.listContent().map((e=>`  - ${indent(e.text,{character:" ",count:4,skipFirstLine:!0})}`)).join("\n")}}class LayoutGeneric{constructor(e,t){this._items=[],this._parentPage=t,e.forEach((e=>{switch(e.BlockType){case"LAYOUT_FIGURE":this._items.push(new LayoutFigureGeneric(e,this));break;case"LAYOUT_HEADER":this._items.push(new LayoutHeaderGeneric(e,this));break;case"LAYOUT_FOOTER":this._items.push(new LayoutFooterGeneric(e,this));break;case"LAYOUT_KEY_VALUE":this._items.push(new LayoutKeyValueGeneric(e,this));break;case"LAYOUT_LIST":this._items.push(new LayoutListGeneric(e,this));break;case"LAYOUT_PAGE_NUMBER":this._items.push(new LayoutPageNumberGeneric(e,this));break;case"LAYOUT_SECTION_HEADER":this._items.push(new LayoutSectionHeaderGeneric(e,this));break;case"LAYOUT_TABLE":this._items.push(new LayoutTableGeneric(e,this));break;case"LAYOUT_TEXT":this._items.push(new LayoutTextGeneric(e,this));break;case"LAYOUT_TITLE":this._items.push(new LayoutTitleGeneric(e,this));break;default:console.warn(`Ignoring unrecognised BlockType '${e.BlockType}' when parsing layout block ${e.Id}`)}}))}get nItems(){return this._items.length}get parentPage(){return this._parentPage}get text(){return this.listItems().map((e=>e.text)).join("\n\n")}html(){return this.listItems().map((e=>e.html())).join("\n")}iterItems(){return getIterable((()=>this.listItems()))}listItems(){return this._items.slice()}str(){return["","#### BEGIN PAGE LAYOUT #################",this.listItems().map((e=>e.str())).join("\n\n"),"#### END PAGE LAYOUT   #################",""].join("\n")}}class QueryResultGeneric extends PageHostedApiBlockWrapper{constructor(e,t){super(e,t.parentPage),this._geometry=e.Geometry?new Geometry(e.Geometry,this):void 0,this._parentQuery=t}get confidence(){return this._dict.Confidence}get geometry(){return this._geometry}get parentQuery(){return this._parentQuery}get text(){return this._dict.Text}html(){return escapeHtml(this.text)}str(){return this.text}}class QueryInstanceGeneric extends PageHostedApiBlockWrapper{constructor(e,t){super(e,t),this._parentPage=t,this.relatedBlockIdsByRelType("ANSWER").forEach((n=>{const i=t.getBlockById(n);i?"QUERY_RESULT"!==i.BlockType?console.warn(`Expected block ${n} to be of type QUERY_RESULT as referenced by QUERY block ${e.Id}, but got type: ${i.BlockType}`):new QueryResultGeneric(i,this):console.warn(`Answer block ${n} referenced by QUERY block ${e.Id} is missing and will be skipped`)}))}get alias(){return this._dict.Query.Alias}get nResults(){return this._listResults().length}get text(){return this._dict.Query.Text}get topResult(){const e=this._listResults(),t=argMax(e.map((e=>e.confidence)));if(!(t.maxIndex<0))return e[t.maxIndex]}_listResults(){return this.relatedBlockIdsByRelType("ANSWER").map((e=>{try{return this.parentPage.getItemByBlockId(e,"QUERY_RESULT")}catch(e){return null}})).filter((e=>e))}listResultsByConfidence(){return this._listResults().slice().sort(((e,t)=>t.confidence-e.confidence))}html(){const e=this.listResultsByConfidence(),t=e.map((e=>`<li>${e.html()}</li>`)).join("\n");return['<div class="query">',indent(`<p>${escapeHtml(this.text)}</p>`),indent(e.length?["<ul>",indent(t),"</ul>"].join("\n"):"<ul></ul>"),"</div>"].join("\n")}str(){return`Query\n==========\nQuestion: ${this.text}\nAnswers:\n - ${this.listResultsByConfidence().map((e=>e.text)).join("\n - ")}`}}class QueryInstanceCollectionGeneric{constructor(e,t){this._queries=[],this._parentPage=t,e.forEach((e=>{this._queries.push(new QueryInstanceGeneric(e,t))}))}get nQueries(){return this._queries.length}get parentPage(){return this._parentPage}get text(){return this._queries.map((e=>`${e.text}\n${e.listResultsByConfidence().map((e=>e.text)).join("\n")}`)).join("\n\n")}getQueryByAlias(e){if(e)return this._queries.find((t=>t.alias===e))}getQueryByQuestion(e){if(e)return this._queries.find((t=>t.text===e))}html(){return['<div class="queries">',indent(this._queries.map((e=>e.html())).join("\n")),"</div>"].join("\n")}iterQueries(e={}){return getIterable((()=>this.listQueries(e)))}listQueries(e={}){return e.skipUnanswered?this._queries.filter((e=>e.nResults>0)):this._queries.slice()}searchQueriesByAlias(e,t={}){if(!e)return[];const n=e.toLowerCase();return this.listQueries(t).filter((e=>e.alias&&e.alias.toLowerCase().indexOf(n)>=0))}searchQueriesByQuestion(e,t={}){if(!e)return[];const n=e.toLowerCase();return this.listQueries(t).filter((e=>e.text.toLowerCase().indexOf(n)>=0))}str(){return this._queries.map((e=>e.str())).join("\n")}}class CellBaseGeneric extends PageHostedApiBlockWrapper{constructor(e,t){super(e,t.parentPage),this._geometry=new Geometry(e.Geometry,this),this._parentTable=t}get geometry(){return this._geometry}get parentTable(){return this._parentTable}}function WithCellBaseProps(e){return class extends e{get columnIndex(){return this.dict.ColumnIndex}get columnSpan(){return this.dict.ColumnSpan||1}get confidence(){return this.dict.Confidence}set confidence(e){this.dict.Confidence=e}get rowIndex(){return this.dict.RowIndex}get rowSpan(){return this.dict.RowSpan||1}getOcrConfidence(e="MEAN"){return aggregate(this.listContent().map((e=>e.confidence)),e)}hasEntityTypes(e){return this.dict.EntityTypes?Array.isArray(e)?e.some((e=>this.dict.EntityTypes.indexOf(e)>=0)):this.dict.EntityTypes.indexOf(e)>=0:null}html(){const e=this.hasEntityTypes(["COLUMN_HEADER","TABLE_SECTION_TITLE","TABLE_TITLE"])?"th":"td";return indent(["<",e,this.columnSpan>1?` colspan="${this.columnSpan}"`:"",this.rowSpan>1?` rowspan="${this.rowSpan}"`:"",">",escapeHtml(this.text),`</${e}>`].join(""),{skipFirstLine:!0})}str(){return this.text}}}class CellGeneric extends(WithCellBaseProps(buildWithContent()(CellBaseGeneric))){constructor(e,t){super(e,t),this._geometry=new Geometry(e.Geometry,this),this.childBlockIds.forEach((e=>{this.parentPage.getBlockById(e)||console.warn(`Document missing child block ${e} referenced by table cell ${this.id}`)}))}}class MergedCellGeneric extends(WithCellBaseProps(buildWithContent()(CellBaseGeneric))){constructor(e,t){super(e,t),this._geometry=new Geometry(e.Geometry,this)}get nSubCells(){return this.listSubCells().length}listSubCells(){return this.childBlockIds.map((e=>this.parentTable._getSplitCellByBlockId(e)))}iterContent(){return{[Symbol.iterator]:()=>{const e=this.listSubCells(),tryListCellContents=t=>e.length>t?e[t].listContent():[];let t=0,n=tryListCellContents(t),i=-1;return{next:()=>{for(++i;i>=n.length;){if(++t,i=0,t>=e.length)return{done:!0,value:void 0};n=tryListCellContents(t)}return{done:!1,value:n[i]}}}}}}listContent(){return[].concat(...this.listSubCells().map((e=>e.listContent())))}iterSubCells(){return getIterable((()=>this.listSubCells()))}}class RowGeneric{constructor(e=[],t){this._cells=e,this._parentTable=t}get nCells(){return this._cells.length}get parentTable(){return this._parentTable}get text(){return this._cells.map((e=>e.text)).join("\t")}getConfidence(e="MEAN"){return aggregate(this._cells.map((e=>e.confidence)),e)}getOcrConfidence(e="MEAN"){return aggregate([].concat(...this._cells.map((e=>e.listContent().map((e=>e.confidence))))),e)}iterCells(){return getIterable((()=>this._cells))}listCells(){return this._cells.slice()}str(){return this._cells.map((e=>`[${e.str()}]`)).join("")}}class TableFooterGeneric extends(WithWords(PageHostedApiBlockWrapper)){get confidence(){return this._dict.Confidence}html(){return escapeHtml(this.text)}str(){return`==== [Table footer] ====\n${this.text}\n========================`}}class TableTitleGeneric extends(WithWords(PageHostedApiBlockWrapper)){get confidence(){return this._dict.Confidence}html(){return escapeHtml(this.text)}str(){return`==== [Table header] ====\n${this.text}\n========================`}}class TableGeneric extends PageHostedApiBlockWrapper{constructor(e,t){super(e,t),this._geometry=new Geometry(e.Geometry,this),this._cells=[];for(const n of e.Relationships){const e=n.Ids.map((e=>{const n=t.getBlockById(e);if(n)return n;console.warn(`Document missing related block ${e} referenced by TABLE ${this.id}`)})).filter((e=>e));"CHILD"===n.Type?this._cells=this._cells.concat(e.map((e=>new CellGeneric(e,this)))):"TABLE_FOOTER"===n.Type?e.map((e=>new TableFooterGeneric(e,t))):"TABLE_TITLE"===n.Type?e.map((e=>new TableTitleGeneric(e,t))):"MERGED_CELL"!==n.Type&&console.warn(`TABLE ${this.id} contained a relationship of unexpected type '${n.Type}' which will be ignored`)}this._sortCellsByLocation(this._cells),this._nCols=this._cells.reduce(((e,t)=>Math.max(e,t.columnIndex+t.columnSpan-1)),0),this._nRows=this._cells.reduce(((e,t)=>Math.max(e,t.rowIndex+t.rowSpan-1)),0),this._cellsById={},this._updateCellsById(),this._mergedCells=[].concat(...(e.Relationships||[]).filter((e=>"MERGED_CELL"==e.Type)).map((e=>e.Ids.map((e=>{const n=t.getBlockById(e);if(n)return new MergedCellGeneric(n,this)})).filter((e=>e)))))}_sortCellsByLocation(e){e.sort(((e,t)=>e.rowIndex-t.rowIndex||e.columnIndex-t.columnIndex))}_updateCellsById(){this._cellsById=this._cells.reduce(((e,t)=>(e[t.id]=t,e)),{})}_getSplitCellByBlockId(e){let t=this._cellsById[e];if(t)return t;if(this._updateCellsById(),t=this._cellsById[e],!t)throw new Error(`Referenced cell ID ${e} missing from TABLE ${this.id}`);return t}cellAt(e,t,n={}){const i=!(n.ignoreMerged||!1)&&this._mergedCells.find((n=>n.columnIndex<=t&&n.columnIndex+n.columnSpan>t&&n.rowIndex<=e&&n.rowIndex+n.rowSpan>e));return i||this._cells.find((n=>n.columnIndex===t&&n.rowIndex===e))}cellsAt(e,t,n={}){const i=n.ignoreMerged||!1?[]:this._mergedCells.filter((n=>(null==e||n.rowIndex<=e&&n.rowIndex+n.rowSpan>e)&&(null==t||n.columnIndex<=t&&n.columnIndex+n.columnSpan>t))),s=i.reduce(((e,t)=>(t.listSubCells().forEach((t=>{e[t.id]=!0})),e)),{}),r=this._cells.filter((n=>!(null!=e&&n.rowIndex!==e||null!=t&&n.columnIndex!==t||n.id in s))),o=i.concat(r);return this._sortCellsByLocation(o),o}getOcrConfidence(e="MEAN"){return aggregate([].concat(...this._cells.map((e=>e.listContent().map((e=>e.confidence))))),e)}iterFooters(){return getIterable((()=>this.listFooters()))}iterRows(e={}){return{[Symbol.iterator]:()=>{let t=0;return{next:()=>t<this._nRows?{done:!1,value:this.rowAt(++t,e)}:{done:!0,value:void 0}}}}}iterTitles(){return getIterable((()=>this.listTitles()))}listFooters(){return this.relatedBlockIdsByRelType("TABLE_FOOTER").map((e=>this.parentPage.getItemByBlockId(e)))}listRows(e={}){return[...Array(this._nRows).keys()].map((t=>this.rowAt(t+1,e)))}listTitles(){return this.relatedBlockIdsByRelType("TABLE_TITLE").map((e=>this.parentPage.getItemByBlockId(e)))}rowAt(e,t={}){const n=t.repeatMultiRowCells||!1,i=this.cellsAt(e,null,{ignoreMerged:t.ignoreMerged});return new RowGeneric(n?i:i.filter((t=>t.rowIndex===e)),this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get firstFooter(){const e=this.listFooters();return e.length?e[0]:void 0}get firstTitle(){const e=this.listTitles();return e.length?e[0]:void 0}get geometry(){return this._geometry}get nCells(){const e=this._mergedCells.map((e=>e.nSubCells)).reduce(((e,t)=>e+t),0);return this._cells.length+this._mergedCells.length-e}get nColumns(){return this._nCols}get nRows(){return this._nRows}get tableType(){if(!this._dict.EntityTypes)return null;const e=this._dict.EntityTypes.indexOf("STRUCTURED_TABLE")>=0,t=+e+ +(this._dict.EntityTypes.indexOf("SEMI_STRUCTURED_TABLE")>=0);if(0===t)return null;if(t>1)throw new Error(`TABLE block ${this._dict.Id} EntityTypes contained multiple conflicting table types: "${this._dict.EntityTypes}"`);return e?"STRUCTURED_TABLE":"SEMI_STRUCTURED_TABLE"}get text(){return this.listRows().map((e=>e.text)).join("\n")}html(){const e=this.listRows().map((e=>["<tr>",indent(e.listCells().map((e=>e.html())).join("\n")),"</tr>"].join("\n"))),t=this.listTitles().map((e=>e.html())),n=this.listFooters().map((e=>e.html()));if(t.length&&n.length){const n=t.length>1?t.map((e=>`<p>${e}</p>`)).join("\n"):t[0],i=t.length>1?t.map((e=>`<p>${e}</p>`)).join("\n"):t[0];return['<div class="table-wrapper">',indent(['<div class="table-title">',indent(n),"</div>","<table>",indent(e.join("\n")),"</table>",'<div class="table-footer">',indent(i),"</div>"].join("\n")),"</div>"].join("\n")}if(t.length||n.length){const i=0!=t.length,s=i?t:n,r=[`<caption style="caption-side: ${i?"top":"bottom"}">`,indent(s.length>1?s.map((e=>`<p>${e}</p>`)).join("\n"):s[0]),"</caption>"].concat(e).join("\n");return`<table>\n${indent(r)}\n</table>`}return`<table>\n${indent(e.join("\n"))}\n</table>`}str(){return"Table\n==========\n"+this.listRows().map((e=>`Row\n==========\n${e.str()}`)).join("\n")}}e.ReadingOrderLayoutMode=void 0,(h=e.ReadingOrderLayoutMode||(e.ReadingOrderLayoutMode={})).Auto="AUTO",h.IgnoreLayout="IGNORE_LAYOUT",h.RequireLayout="REQUIRE_LAYOUT";class Page extends ApiBlockWrapper{constructor(e,t,n){super(e),this._blocks=t,this._parentDocument=n,this._geometry=new Geometry(e.Geometry,this),this._content=[],this._lines=[],this._tables=[],this._form=new FormGeneric([],this),this._itemsByBlockId={},this._layout=new LayoutGeneric([],this),this._queries=new QueryInstanceCollectionGeneric([],this),this._parse(t)}_parse(e){this._content=[],this._itemsByBlockId={},this._lines=[],this._tables=[];const t=[],n=[],i=[];e.forEach((e=>{if("LINE"==e.BlockType){const t=new LineGeneric(e,this);this._lines.push(t),this._content.push(t),this._itemsByBlockId[t.id]=t}else if("KEY"===e.BlockType)t.push(e);else if("KEY_VALUE_SET"===e.BlockType)e.EntityTypes.indexOf("KEY")>=0&&t.push(e);else if(isLayoutBlockType(e.BlockType))n.push(e);else if("QUERY"===e.BlockType)i.push(e);else if("SELECTION_ELEMENT"===e.BlockType){const t=new SelectionElement(e);this._itemsByBlockId[t.id]=t}else if("SIGNATURE"===e.BlockType){const t=new Signature(e);this._itemsByBlockId[t.id]=t}else if("TABLE"===e.BlockType){const t=new TableGeneric(e,this);this._tables.push(t),this._content.push(t),this._itemsByBlockId[t.id]=t}else if("WORD"===e.BlockType){const t=new Word(e);this._itemsByBlockId[t.id]=t}})),this._form=new FormGeneric(t,this),this._queries=new QueryInstanceCollectionGeneric(i,this),this._layout=new LayoutGeneric(n,this)}getBlockById(e){return this._parentDocument.getBlockById(e)}getItemByBlockId(e,t){if(e===this.id)return this;const n=this._itemsByBlockId[e];if(!n)throw new Error(`Missing parser item for block ID ${e}`);if(t){if(!(Array.isArray(t)?t.indexOf(n.blockType)>=0:t===n.blockType))throw new Error(`Parser item for block ID ${e} had BlockType ${n.blockType} (expected ${t})`)}return n}getModalWordOrientationDegrees(){const e=this.listLines().map((e=>e.listWords().map((e=>e.geometry.orientationDegrees()))));return modalAvg([].concat(...e).filter((e=>null!=e)).map((e=>Math.round(e))))}_getLineClustersByColumn({colHOverlapThresh:e=.8,colHMultilineUnionThresh:t=.7,paraVDistTol:n=.7,paraLineHeightTol:i=.3,paraIndentThresh:s=0}={}){const r=[],o=[],l=[],a=this._lines.map((e=>e.geometry.boundingBox.hCenter));this._lines.forEach(((e,t)=>{const c=e.geometry.boundingBox,u=a[t];let h,d;/[^.,_\s]/.test(e.text)?/[^-–—=~\s]/.test(e.text)?/[^'"`^\s]/.test(e.text)?/[^-–—=~.,_acemnorsuvwxz+<>:;\s]/.test(e.text)?(h=!1,d=c):(h=!1,d=new BoundingBox({Top:c.top-.25*c.height,Left:c.left,Height:1.25*c.height,Width:c.width},null)):(h=!0,d=new BoundingBox({Top:c.top,Left:c.left,Height:2.5*c.height,Width:c.width},null)):(h=!0,d=new BoundingBox({Top:c.top-.75*c.height,Left:c.left,Height:2.5*c.height,Width:c.width},null)):(h=!0,d=new BoundingBox({Top:c.top-1.5*c.height,Left:c.left,Height:2.5*c.height,Width:c.width},null));let p=null;for(let t=0;t<r.length;++t){const a=r[t],g=a.hCenter,m=o[t].length;let y,_;h?(_=l[t]/m,y=_*(m+1)):(y=l[t]+d.height,_=y/(m+1));const T=Math.max(0,d.top-a.bottom,a.top-d.bottom);let f;if(s){const e=o[t][m-1].geometry.boundingBox.left-(1===m?s*_:0),n=Math.max(d.top,a.top),i=Math.min(d.bottom,a.bottom),r=Math.max(0,i-n);f=Math.max(0,d.left-e)<s*_||r>.5*d.height}else f=!0;if((u>a.left&&u<a.right||g>c.left&&g<c.right)&&T<_*n&&(h||Math.abs((_-d.height)/_)<i)&&f){p=t,r[t]=a.union(c),o[t].push(e),l[t]=y;break}}null==p&&(r.push(new BoundingBox(c.dict)),o.push([e]),l.push(c.height))}));const c=[],u=[];return o.forEach(((n,i)=>{const s=r[i];let a=null;for(let r=0;r<c.length;++r){const h=c[r],d=u[r],p=Math.max(h.top,s.top),g=Math.min(h.bottom,s.bottom),m=Math.max(0,g-p),y=Math.max(h.left,s.left),_=Math.min(h.right,s.right),T=Math.max(0,_-y),f=Math.max(h.right,s.right)-Math.min(h.left,s.left),x=Math.min(h.width,s.width),E=h.union(s),I=1===n.length||1===d.length&&1===d[0].length;if(m<.1*(l[i]/o[i].length)&&T/x>=e&&(I||T/f>=t)&&T/x>=e&&1===c.filter((e=>e.intersection(E))).length){a=r,c[r]=h.union(s),u[r].push(n);break}}null==a&&(c.push(new BoundingBox(s.dict)),u.push([n]))})),u}getLineClustersInReadingOrder({colHOverlapThresh:e=.8,colHMultilineUnionThresh:t=.7,paraVDistTol:n=.7,paraLineHeightTol:i=.3,paraIndentThresh:s=0,useLayout:r="AUTO"}={}){if(this.hasLayout){if("IGNORE_LAYOUT"!==r)return this.layout.listItems().map((e=>e.listTextLines()))}else if("REQUIRE_LAYOUT"===r)throw new Error(`Configured with useLayout=${r}, but Amazon Textract Layout analysis results not found on page ${this.id}`);return[].concat(...this._getLineClustersByColumn({colHOverlapThresh:e,colHMultilineUnionThresh:t,paraVDistTol:n,paraLineHeightTol:i,paraIndentThresh:s}))}getTextInReadingOrder({colHOverlapThresh:e=.8,colHMultilineUnionThresh:t=.7,paraVDistTol:n=.7,paraLineHeightTol:i=.3,paraIndentThresh:s=0,useLayout:r="AUTO"}={}){return this.getLineClustersInReadingOrder({colHOverlapThresh:e,colHMultilineUnionThresh:t,paraVDistTol:n,paraLineHeightTol:i,paraIndentThresh:s,useLayout:r}).map((e=>e.map((e=>e.text)).join("\n"))).join("\n\n")}_groupLinesByVerticalGaps(e,t,n){let i=[new BoundingBox({Top:e,Left:this._geometry.boundingBox.left,Height:t,Width:this._geometry.boundingBox.width},null)],s=[[]],r=[];return(n||this._lines).forEach((e=>{const t=e.geometry.boundingBox;if(t.top>i[i.length-1].bottom)return void r.push(e);if(t.bottom<i[0].top)return void s[0].push(e);const n=[],o=[];let l=[],a=!1;for(let r=0;r<i.length;++r){const c=i[r],u=s[r],h=t.intersection(c);if(h)if(h.top!==c.top||h.height!==c.height)if(h.top>c.top&&h.bottom<c.bottom)n.push(new BoundingBox({Top:c.top,Left:c.left,Height:h.top-c.top,Width:c.width},null)),o.push(l.concat(u)),l=[],n.push(new BoundingBox({Top:h.bottom,Left:c.left,Height:c.bottom-h.bottom,Width:c.width},null)),o.push([e]),a=!0;else{const t=l.concat(u);h.top===c.top?(t.push(e),a=!0,n.push(new BoundingBox({Top:c.top+h.height,Left:c.left,Height:c.height-h.height,Width:c.width},null))):n.push(new BoundingBox({Top:c.top,Left:c.left,Height:h.top-c.top,Width:c.width},null)),o.push(t),l=[]}else l=l.concat(u);else n.push(c),o.push(l.concat(u)),l=[]}if(i=n,s=o,r=l.concat(r),!a){const n=i.findIndex((e=>e.top>=t.bottom));n<0?r.push(e):s[n].push(e)}})),{vGaps:i,lines:s.concat([r])}}_getHeaderOrFooterLines(e,{maxMargin:t=.16,minGap:n=.8}={},i){const{vGaps:s,lines:r}=this._groupLinesByVerticalGaps(e?this._geometry.boundingBox.top:this._geometry.boundingBox.bottom-t,t,i),o=r.map((e=>e.length?e.reduce(((e,t)=>e+t.geometry.boundingBox.height),0)/e.length:null)),l=o.filter((e=>e)),a=l.reduce(((e,t)=>e+t),0)/l.length,c=s.map(((e,t)=>{const n=[],i=o[t];i&&n.push(i);const s=o[t+1];return s&&n.push(s),n.length?n.reduce(((e,t)=>e+t),0)/n.length:a}));if(e){const e=s.findIndex(((e,t)=>(t>0||r[t].length)&&e.height>=c[t]*n));return e<0?[]:[].concat(...r.slice(0,e+1))}{const e=r.slice().reverse(),t=c.slice().reverse(),i=s.slice().reverse().findIndex(((i,s)=>(s>0||e[s].length)&&i.height>=t[s]*n));return i<0?[]:[].concat(...r.slice(s.length-i))}}getFooterLines(e={},t){return this._getHeaderOrFooterLines(!1,e,t)}getHeaderLines(e={},t){return this._getHeaderOrFooterLines(!0,e,t)}getLinesByLayoutArea(e=!1,t={},n={}){const i=e?[].concat(...!0===e?this.getLineClustersInReadingOrder():this.getLineClustersInReadingOrder(e)):this._lines,s=i.reduce(((e,t,n)=>(e[t.id]=n,e)),{}),r=this._getHeaderOrFooterLines(!0,t,i).sort(((e,t)=>s[e.id]-s[t.id]));let o=r.reduce(((e,t)=>(e[t.id]=!0,e)),{});const l=this._getHeaderOrFooterLines(!1,n,i.filter((e=>!(e.id in o)))).sort(((e,t)=>s[e.id]-s[t.id]));return o=l.reduce(((e,t)=>(e[t.id]=!0,e)),o),{header:r,content:i.filter((e=>!(e.id in o))).sort(((e,t)=>s[e.id]-s[t.id])),footer:l}}iterLines(){return getIterable((()=>this._lines))}iterSignatures(){return getIterable((()=>this.listSignatures()))}iterTables(){return getIterable((()=>this._tables))}lineAtIndex(e){if(e<0||e>=this._lines.length)throw new Error(`Line index ${e} must be >=0 and <${this._lines.length}`);return this._lines[e]}listBlocks(){return this._blocks.slice()}listLines(){return this._lines.slice()}listSignatures(){return this._blocks.filter((e=>"SIGNATURE"===e.BlockType)).map((e=>this.getItemByBlockId(e.Id)))}listTables(){return this._tables.slice()}registerParsedItem(e,t){this._itemsByBlockId[e]=t}tableAtIndex(e){if(e<0||e>=this._tables.length)throw new Error(`Table index ${e} must be >=0 and <${this._tables.length}`);return this._tables[e]}get form(){return this._form}get geometry(){return this._geometry}get hasLayout(){return this._layout.nItems>0}get layout(){return this._layout}get nLines(){return this._lines.length}get nSignatures(){return this.listSignatures().length}get nTables(){return this._tables.length}get pageNumber(){const e=this._parentDocument._pages.indexOf(this);if(e<0)throw new Error("parentDocument does not seem to contain this Page");return e+1}get parentDocument(){return this._parentDocument}get queries(){return this._queries}get text(){return this._lines.map((e=>e.text)).join("\n")}html(){if(this.hasLayout)return this._layout.html();throw new Error("Page.html() is not yet implemented for results where Textract LAYOUT was not enabled")}str(){return`Page\n==========\n${this._content.join("\n")}\n`}}class TextractDocument extends ApiObjectWrapper{constructor(e){var t;let n;if(Array.isArray(e))n=TextractDocument._consolidateMultipleResponses(e);else{if(!("Blocks"in e)||!(null===(t=e.Blocks)||void 0===t?void 0:t.length))throw new Error("Provided Textract JSON has no content! (.Blocks array)");n=e}super(n),"NextToken"in this._dict&&this._dict.NextToken&&console.warn("Provided Textract JSON contains a NextToken: Content may be truncated!"),this._blockMap={},this._pages=[],this._form=new FormsCompositeGeneric([],this),this._parse()}_parse(){this._blockMap=this._dict.Blocks.reduce(((e,t)=>(e[t.Id]=t,e)),{});let e=null,t=[];this._pages=[],this._dict.Blocks.forEach((n=>{"PAGE"==n.BlockType?(e&&this._pages.push(new Page(e,t,this)),e=n,t=[n]):t.push(n)})),e&&this._pages.push(new Page(e,t,this)),this._form=new FormsCompositeGeneric(this._pages.map((e=>e.form)),this)}static _consolidateMultipleResponses(e){if(!(null==e?void 0:e.length))throw new Error("Input Textract Results list empty!");let t=0;const n={Pages:0};let i=[],s="",r=null,o=null,l=null,a=null;for(const c of e){if("Blocks"in c&&c.Blocks?i=i.concat(c.Blocks):console.warn("Found Textract response with no content"),"DocumentMetadata"in c&&(Object.assign(n,c.DocumentMetadata),t=Math.max(t,c.DocumentMetadata.Pages)),"AnalyzeDocumentModelVersion"in c){if(r&&"AnalyzeDocument"!==r)throw new Error("Inconsistent textractResults contain both AnalyzeDocument and DetectText results");r="AnalyzeDocument",s&&s!==c.AnalyzeDocumentModelVersion?console.warn(`Inconsistent Textract model versions ${s} and ${c.AnalyzeDocumentModelVersion}: Ignoring latter`):s=c.AnalyzeDocumentModelVersion}if("DetectDocumentTextModelVersion"in c){if(r&&"DetectText"!==r)throw new Error("Inconsistent textractResults contain both AnalyzeDocument and DetectText results");r="DetectText",s&&s!==c.DetectDocumentTextModelVersion?console.warn(`Inconsistent Textract model versions ${s} and ${c.DetectDocumentTextModelVersion}: Ignoring latter`):s=c.DetectDocumentTextModelVersion}if("JobStatus"in c){if("FAILED"==c.JobStatus||(c.JobStatus||"").toLocaleUpperCase().indexOf("FAIL")>=0)throw new Error(`Textract results contain failed job of status ${c.JobStatus}`);if(o&&o!==c.JobStatus)throw new Error(`Textract results inconsistent JobStatus values ${o}, ${c.JobStatus}`);o=c.JobStatus}"StatusMessage"in c&&c.StatusMessage&&(l&&c.StatusMessage!==l?(console.warn("Multiple StatusMessages in Textract results - keeping longest"),c.StatusMessage.length>l.length&&(l=c.StatusMessage)):l=c.StatusMessage),"Warnings"in c&&c.Warnings&&(a=a?a.concat(c.Warnings):c.Warnings)}const c={DocumentMetadata:n,Blocks:i},u="AnalyzeDocument"==r?{AnalyzeDocumentModelVersion:s}:"DetectText"==r?{DetectDocumentTextModelVersion:s}:{AnalyzeDocumentModelVersion:s||"Unknown"},h=o?{JobStatus:o}:{},d=l?{StatusMessage:l}:{},p=a?{ArfBarf:a}:{},g=e[e.length-1],m="NextToken"in g?{NextToken:g.NextToken}:{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c),u),h),d),p),m)}get form(){return this._form}get nPages(){return this._pages.length}get text(){return this._pages.map((e=>e.text)).join("\n\n\n\n")}getBlockById(e){return this._blockMap&&this._blockMap[e]}getItemByBlockId(e,t){for(const n of this._pages)try{return n.getItemByBlockId(e,t)}catch(e){}throw new Error(`No parser item found on any page, for block ID ${e}`)}iterPages(){return getIterable((()=>this._pages))}listBlocks(){return this._dict.Blocks.slice()}listPages(){return this._pages.slice()}pageNumber(e){if(!(e>=1&&e<=this._pages.length))throw new Error(`pageNum ${e} must be between 1 and ${this._pages.length}`);return this._pages[e-1]}html(){return`<!DOCTYPE html>\n<html>\n${["<body>",indent(this._pages.map((e=>`<div class="page">\n${indent(e.html())}\n</div>`)).join("\n")),"</body>"].join("\n")}\n</html>`}str(){return`\nDocument\n==========\n${this._pages.map((e=>e.str())).join("\n\n")}\n\n`}}class ExpenseComponentDetection extends ApiObjectWrapper{constructor(e,t){super(e),this._parentField=t,this._geometry=e.Geometry?new Geometry(e.Geometry,this):void 0}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get parentField(){return this._parentField}get text(){return this._dict.Text}set text(e){this._dict.Text=e}}class ExpenseFieldType extends ApiObjectWrapper{constructor(e,t){super(e),this._parentField=t}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get parentField(){return this._parentField}get text(){return this._dict.Text}set text(e){this._dict.Text=e}}class ExpenseField extends ApiObjectWrapper{constructor(e,t){super(e),this._parent=t,this._fieldType=new ExpenseFieldType(e.Type,this),this._label=e.LabelDetection?new ExpenseComponentDetection(e.LabelDetection,this):null,this._value=new ExpenseComponentDetection(e.ValueDetection,this)}get fieldType(){return this._fieldType}get label(){return this._label}get pageNumber(){return this._dict.PageNumber}get parent(){return this._parent}get value(){return this._value}}class ExpenseLineItem extends ApiObjectWrapper{constructor(e,t){super(e),this._parentGroup=t,this._fields=(e.LineItemExpenseFields||[]).map((e=>new ExpenseField(e,this)))}get nFields(){return this._fields.length}get parentGroup(){return this._parentGroup}iterFields(){return getIterable((()=>this._fields))}listFields(){return this._fields.slice()}getFieldByType(e){const t=this.searchFieldsByType(e);return t.length?t[0]:null}searchFieldsByType(e){return this._fields.filter((t=>t.fieldType.text==e))}}class ExpenseLineItemGroup extends ApiObjectWrapper{constructor(e,t){super(e),this._parentDoc=t,this._lineItems=(e.LineItems||[]).map((e=>new ExpenseLineItem(e,this)))}get index(){return this._dict.LineItemGroupIndex}get nLineItems(){return this._lineItems.length}get parentDoc(){return this._parentDoc}iterLineItems(){return getIterable((()=>this._lineItems))}listLineItems(){return this._lineItems.slice()}}class ExpenseDocument extends ApiObjectWrapper{constructor(e,t=null){super(e),this._parentExpense=t,this._lineItemGroups=(e.LineItemGroups||[]).map((e=>new ExpenseLineItemGroup(e,this))),this._summaryFields=(e.SummaryFields||[]).map((e=>new ExpenseField(e,this)))}get index(){return this._dict.ExpenseIndex}get nLineItemGroups(){return this._lineItemGroups.length}get nSummaryFields(){return this._summaryFields.length}get parentExpense(){return this._parentExpense}getSummaryFieldByType(e){const t=this.searchSummaryFieldsByType(e);return t.length?t[0]:null}searchSummaryFieldsByType(e){return this._summaryFields.filter((t=>t.fieldType.text==e))}iterLineItemGroups(){return getIterable((()=>this._lineItemGroups))}iterSummaryFields(){return getIterable((()=>this._summaryFields))}listLineItemGroups(){return this._lineItemGroups.slice()}listSummaryFields(){return this._summaryFields.slice()}}e.IdFieldType=void 0,(d=e.IdFieldType||(e.IdFieldType={})).FirstName="FIRST_NAME",d.LastName="LAST_NAME",d.MiddleName="MIDDLE_NAME",d.Suffix="SUFFIX",d.AddressCity="CITY_IN_ADDRESS",d.AddressZipCode="ZIP_CODE_IN_ADDRESS",d.AddressState="STATE_IN_ADDRESS",d.StateName="STATE_NAME",d.DocumentNumber="DOCUMENT_NUMBER",d.ExpirationDate="EXPIRATION_DATE",d.DateOfBirth="DATE_OF_BIRTH",d.DateOfIssue="DATE_OF_ISSUE",d.IdType="ID_TYPE",d.Endorsements="ENDORSEMENTS",d.Veteran="VETERAN",d.Restrictions="RESTRICTIONS",d.Class="CLASS",d.Address="ADDRESS",d.County="COUNTY",d.PlaceOfBirth="PLACE_OF_BIRTH",d.Other="OTHER",e.IdFieldValueType=void 0,(p=e.IdFieldValueType||(e.IdFieldValueType={})).Date="DATE",p.Other="OTHER",e.IdDocumentType=void 0,(g=e.IdDocumentType||(e.IdDocumentType={})).DrivingLicense="DRIVER LICENSE FRONT",g.Passport="PASSPORT",g.Other="OTHER";class IdDocumentField extends ApiObjectWrapper{constructor(e,t=void 0){super(e),this._parentDocument=t}get isValueNormalized(){var e,t;return void 0!==(null===(t=null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.NormalizedValue)||void 0===t?void 0:t.Value)}get fieldTypeRaw(){var e;return null===(e=this._dict.Type)||void 0===e?void 0:e.Text}get fieldType(){var t;const n=this._dict.Type,i=((null===(t=null==n?void 0:n.NormalizedValue)||void 0===t?void 0:t.Value)||(null==n?void 0:n.Text)||"").toUpperCase();return Object.values(e.IdFieldType).some((e=>e===i))?i:e.IdFieldType.Other}get parentDocument(){return this._parentDocument}get value(){var e;const t=this._dict.ValueDetection;return(null===(e=null==t?void 0:t.NormalizedValue)||void 0===e?void 0:e.Value)||(null==t?void 0:t.Text)||""}get valueConfidence(){var e;return(null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.Confidence)||0}get valueRaw(){var e;return null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.Text}get valueType(){var e,t;let n=null===(t=null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.NormalizedValue)||void 0===t?void 0:t.ValueType;return n&&(n=n.toUpperCase()),"DATE"===n?"DATE":"OTHER"}str(){return`${this.fieldType}: ${this.value} (${this.valueConfidence.toFixed(1)}% Confidence)`}}class IdDocument extends ApiObjectWrapper{constructor(e,t=void 0){super(e),this._parentResult=t,this._fields=(e.IdentityDocumentFields||[]).map((e=>new IdDocumentField(e,this))),this._fieldsByNormalizedType={},this._fields.forEach((e=>{this._fieldsByNormalizedType[e.fieldType]=e}))}get index(){return this._dict.DocumentIndex}get idType(){var t;const n=null===(t=this.getFieldByType(e.IdFieldType.IdType))||void 0===t?void 0:t.value;return Object.values(e.IdDocumentType).some((e=>e===n))?n:e.IdDocumentType.Other}get nFields(){return this._fields.length}get parentCollection(){return this._parentResult}getFieldByType(e){return this._fieldsByNormalizedType[e]}iterFields(){return getIterable((()=>this.listFields()))}listFields(){return this._fields.slice()}str(){const e=this._fields.map((e=>e.str())).join("\n");return`==========\nIdentity Document ${this.index} (${this.idType})\n----------\n${e}\n==========`}}return e.ApiBlockWrapper=ApiBlockWrapper,e.BoundingBox=BoundingBox,e.Cell=class Cell extends CellGeneric{},e.DocumentMetadata=DocumentMetadata,e.ExpenseComponentDetection=ExpenseComponentDetection,e.ExpenseDocument=ExpenseDocument,e.ExpenseField=ExpenseField,e.ExpenseFieldType=ExpenseFieldType,e.ExpenseLineItem=ExpenseLineItem,e.ExpenseLineItemGroup=ExpenseLineItemGroup,e.Field=class Field extends FieldGeneric{},e.FieldKey=class FieldKey extends FieldKeyGeneric{},e.FieldValue=class FieldValue extends FieldValueGeneric{},e.Form=class Form extends FormGeneric{},e.FormsComposite=class FormsComposite extends FormsCompositeGeneric{},e.Geometry=Geometry,e.IdDocument=IdDocument,e.IdDocumentField=IdDocumentField,e.Layout=class Layout extends LayoutGeneric{},e.LayoutFigure=class LayoutFigure extends LayoutFigureGeneric{},e.LayoutFooter=class LayoutFooter extends LayoutFooterGeneric{},e.LayoutHeader=class LayoutHeader extends LayoutHeaderGeneric{},e.LayoutKeyValue=class LayoutKeyValue extends LayoutKeyValueGeneric{},e.LayoutList=class LayoutList extends LayoutListGeneric{},e.LayoutPageNumber=class LayoutPageNumber extends LayoutPageNumberGeneric{},e.LayoutSectionHeader=class LayoutSectionHeader extends LayoutSectionHeaderGeneric{},e.LayoutTable=class LayoutTable extends LayoutTableGeneric{},e.LayoutText=class LayoutText extends LayoutTextGeneric{},e.LayoutTitle=class LayoutTitle extends LayoutTitleGeneric{},e.Line=class Line extends LineGeneric{},e.MergedCell=class MergedCell extends MergedCellGeneric{},e.Page=Page,e.Point=Point,e.QueryInstance=class QueryInstance extends QueryInstanceGeneric{},e.QueryInstanceCollection=class QueryInstanceCollection extends QueryInstanceCollectionGeneric{},e.QueryResult=class QueryResult extends QueryResultGeneric{},e.Row=class Row extends RowGeneric{},e.SelectionElement=SelectionElement,e.Signature=Signature,e.Table=class Table extends TableGeneric{},e.TableFooter=class TableFooter extends TableFooterGeneric{},e.TableTitle=class TableTitle extends TableTitleGeneric{},e.TextractDocument=TextractDocument,e.TextractExpense=class TextractExpense extends ApiObjectWrapper{constructor(e){if(super(e),!e.ExpenseDocuments)throw new Error("Input doesn't seem like a Textract expense analysis result: missing property 'ExpenseDocuments'");this._metadata=new DocumentMetadata(e.DocumentMetadata),this._docs=(e.ExpenseDocuments||[]).map((e=>new ExpenseDocument(e,this)))}get metadata(){return this._metadata}get nDocs(){return this._docs.length}iterDocs(){return getIterable((()=>this._docs))}listDocs(){return this._docs.slice()}},e.TextractIdentity=class TextractIdentity extends ApiObjectWrapper{constructor(e){super(e),this._documents=(e.IdentityDocuments||[]).map((e=>new IdDocument(e,this)))}get modelVersion(){return this._dict.AnalyzeIDModelVersion}get nDocuments(){return this._documents.length}get nPages(){var e;return(null===(e=this._dict.DocumentMetadata)||void 0===e?void 0:e.Pages)||0}getDocAtIndex(e){if(!(e>=0&&e<this._documents.length))throw new Error(`Document index ${e} must be between 0 and ${this._documents.length}`);return this._documents[e]}iterDocuments(){return getIterable((()=>this.listDocuments()))}listDocuments(){return this._documents.slice()}str(){return this._documents.map((e=>e.str())).join("\n\n")}},e.Word=Word,e.aggregate=aggregate,e.argMax=argMax,e.escapeHtml=escapeHtml,e.getIterable=getIterable,e.indent=indent,e.isLayoutBlockType=isLayoutBlockType,e.modalAvg=modalAvg,e}({});
//# sourceMappingURL=trp.min.js.map
